/**
 * Formatter plugin
 *
 * @version 1.0
 * @requires jQuery v1.3
 * @author Kevan Davis
 * @copyright Copyright (c) 2010, Gilt Groupe
 *
 * Distributed under the terms of the GNU General Public License
 * http://www.gnu.org/licenses/gpl-3.0.html
 *
 */
(function(e){e.formatter={defaults:{creditcard:{stripRegex:/\D/g,fillEmptyDigits:false,types:[{name:"Test",digits:13,prefix:/^(4222222222222)$/,groupRegex:/([\d_\*])([\d_\*]{3})([\d_\*]{3})([\d_\*]{3})([\d_\*]{3})/,groupReplace:"$1 $2 $3 $4 $5"},{name:"Visa",digits:16,prefix:/^(4)/,groupRegex:/([\d_\*]{4})([\d_\*]{4})([\d_\*]{4})([\d_\*]{4})/,groupReplace:"$1 $2 $3 $4"},{name:"Master Card",digits:16,prefix:/^(5[1-5])/,groupRegex:/([\d_\*]{4})([\d_\*]{4})([\d_\*]{4})([\d_\*]{4})/,groupReplace:"$1 $2 $3 $4"}, {name:"Discover",digits:16,prefix:/^(6011|65)/,groupRegex:/([\d_\*]{4})([\d_\*]{4})([\d_\*]{4})([\d_\*]{4})/,groupReplace:"$1 $2 $3 $4"},{name:"American Express",digits:15,prefix:/^(34|37)/,groupRegex:/([\d_\*]{4})([\d_\*]{6})([\d_\*]{5})/,groupReplace:"$1 $2 $3"},{name:"Diner's Club",digits:14,prefix:/^(30[0-5]|36|38)/,groupRegex:/([\d_\*]{4})([\d_\*]{5})([\d_\*]{5})/,groupReplace:"$1 $2 $3"},{name:"JCB",digits:16,prefix:/^(3)/,groupRegex:/([\d_\*]{4})([\d_\*]{4})([\d_\*]{4})([\d_\*]{4})/,groupReplace:"$1 $2 $3 $4"}, {name:"JCB",digits:15,prefix:/^(2131|1800)/,groupRegex:/([\d_\*]{4})([\d_\*]{6})([\d_\*]{5})/,groupReplace:"$1 $2 $3"},{name:"Enroute",digits:15,prefix:/^(2014|2149)/,groupRegex:/([\d_\*]{4})([\d_\*]{6})([\d_\*]{5})/,groupReplace:"$1 $2 $3"},{name:"Unknown",digits:16,prefix:/^/,groupRegex:/([\d_\*]{4})([\d_\*]{4})([\d_\*]{4})([\d_\*]{4})/,groupReplace:"$1 $2 $3 $4"}]},phone:{fillEmptyDigits:false,types:[{name:"Japan",digits:10,prefix:/^(\+81)/,preStripRegex:/[\s\(\)x\-\*]/g,groupRegex:/(\+81)([\d_\*]{0,2})([\d_\*]{0,4})([\d_\*]{0,4})([\d_\*]*)/, groupReplace:"$1-$2-$3-$4-$5",postStripRegex:/( ?\-|\)|\()$/g,trimRegex:/^ /},{name:"North America",digits:10,prefix:/^(\+?1)|^\d|^\(/,preStripRegex:/[\s\(\)x\-\*]/g,groupRegex:/(\+?1?)([\d_\*]{0,3})([\d_\*]{0,3})([\d_\*]{0,4})([\d_\*]*)/,groupReplace:"$1 ($2) $3-$4 x$5",postStripRegex:/( x| ?\-|\)|\()$/g,fix:[{regex:/\(([\d_\*][\d_\*][\d_\*])$/,replace:"($1)"},{regex:/\ ([\d_\*][\d_\*][\d_\*])$/,replace:" $1-"}],trimRegex:/^ /}]},commas:{stripRegex:/,/g,groupRegex:/(?!^)(\d{3})(?=(\d{3})*$)/g,groupReplace:"$1", groupDelimiter:",",decimalDelimiter:".",insertCommasOnLeftSide:true,insertCommasOnRightSide:false}}};e.formatter.creditcard=function(b,d){d=e.extend({},e.formatter.defaults.creditcard,d);var c,a;b=b.replace(d.stripRegex,"");if(0!==b.length){a=0;for(c=null;a<d.types.length&&null===c;a+=1)if(d.types[a].prefix.test(b))c=d.types[a];for(a=b.length;a<c.digits;a+=1)b+=d.fillEmptyDigits?"*":"_";return b.replace(c.groupRegex,c.groupReplace).replace(/_/g,"").replace(/\s+$/,"")}return""};e.formatter.phone=function(b, d){d=e.extend({},e.formatter.defaults.phone,d);var c,a,f;if(0!==b.length){a=0;for(c=null;a<d.types.length&&null===c;a+=1)if(d.types[a].prefix.test(b))c=d.types[a];b=b.replace(c.preStripRegex,"");f=(b.match(c.prefix)[1]||"").length+c.digits;for(a=b.length;a<f;a+=1)b+=d.fillEmptyDigits?"*":"_";b=b.replace(c.groupRegex,c.groupReplace).replace(c.postStripRegex,"");if(c.hasOwnProperty("fix"))for(a=0;a<c.fix.length;a+=1)b=b.replace(c.fix[a].regex,c.fix[a].replace);return b=b.replace(c.trimRegex,"").replace(/_/g, "")}return""};e.formatter.commas=function(b,d){d=e.extend({},e.formatter.defaults.commas,d);b=b.replace(d.stripRegex,"").split(d.decimalDelimiter);if(d.insertCommasOnLeftSide)b[0]=b[0].replace(d.groupRegex,d.groupDelimiter+d.groupReplace);if(d.insertCommasOnRightSide&&2===b.length)b[1]=b[1].split("").reverse().join("").replace(d.groupRegex,d.groupDelimiter+d.groupReplace).split("").reverse().join("");return 1===b.length?b[0]:b[0]+d.decimalDelimiter+b[1]};e.fn.format=function(b,d){if(!e.isFunction(b)){d= b;b=null}this.each(function(){var c=e(this),a=b;if(!e.isFunction(a))for(a in e.formatter)if("defaults"!==a&&e.formatter.hasOwnProperty(a)&&e.isFunction(e.formatter[a]))if(c.hasClass(a)||c.attr("data-formatter")===a){a=e.formatter[a];break}if(""!==c.val()){a=a(c.val(),d);a!==c.val()&&c.val(a)}else if(""!==c.html()){a=a(c.html(),d);a!==c.html()&&c.html(a)}});return this};e.fn.formatAsYouType=function(b,d){e.fn.hasOwnProperty("caret")&&this.each(function(){e(this).keyup(function(c){if(48<=c.keyCode&& 57>=c.keyCode){c=e(this).caret();var a=e(this).val().length;e(this).format(b,d);c<a&&e(this).caret(c)}})});return this}})(jQuery);